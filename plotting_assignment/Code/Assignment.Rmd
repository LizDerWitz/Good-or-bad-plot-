---
title: "Assignment"
output: html_document
date: "2025-02-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Creating the data

Defining the folder path:
# data_folder <- "plotting_assignment/data"

Creating the folder:
Checking if the folder already exist, if not then:
#if (!dir.exists(data_folder)) {dir.create(data_folder, recursive = TRUE)}

Asking R to simulate a speed dating dataset:
For reproducibility:
# set.seed(123)  
Number of participants:
# n <- 100  


speed_dating_data <- data.frame(   
With id from 1 to n (1000):
#  participant_id = 1:n,    
With age between 18 and 40, the same age can be chosen more than once:
# age = sample(18:40, n, replace = TRUE),    
I am considering only cis people:
# gender = sample(c("Male", "Female"), n, replace = TRUE),
Random scores from 1 to 10, simulating attractiveness
# attractiveness_rating = runif(n, 1, 10),  
1 -> attracted to the partner, 0 -> not attracted
#attraction_feeling = sample(0:1, n, replace = TRUE, prob = c(0.5, 0.5)),
0 = No match, 1 = Match of interests,60% chances of no match, 40% of match:
# interests_match = sample(0:1, n, replace = TRUE, prob = c(0.6, 0.4)), 
Randomly assign a partner_id (random partner for each participant):
partner_id = sample(1:n, n, replace = TRUE))

Save the data as a CSV file inside the "data" folder:
# write.csv(speed_dating_data, file = file.path(data_folder, "speed_dating_data.csv"), row.names = FALSE)

Message to confirm:
# cat("Speed dating dataset created and saved in 'plotting_assignment/data/speed_dating_data.csv'\n")

```{r creating the data}
data_folder <- "plotting_assignment/data"
if (!dir.exists(data_folder)) {dir.create(data_folder, recursive = TRUE)}
set.seed(123) 
n <- 1000  
speed_dating_data <- data.frame(   
participant_id = 1:n,    
age = sample(18:40, n, replace = TRUE),    
gender = sample(c("Male", "Female"), n, replace = TRUE),
attractiveness_rating = runif(n, 1, 10),  
attraction_feeling = sample(0:1, n, replace = TRUE, prob = c(0.5, 0.5)),
interests_match = sample(0:1, n, replace = TRUE, prob = c(0.6, 0.4)),
partner_id = sample(1:n, n, replace = TRUE))

write.csv(speed_dating_data, file = file.path(data_folder, "speed_dating_data.csv"), row.names = FALSE)

cat("Speed dating dataset created and saved in 'plotting_assignment/data/speed_dating_data.csv'\n")


```

# Filtering the data

installing package:
library(dplyr)

#renaming
liked_data <- speed_dating_data %>%
#keeping only the ones who felt an attraction
  filter(interests_match == 1) %>%  
#keeping only the liker's participant id
  select(participant_id, age, partner_id) %>% 
#joining by attracted id
  left_join(speed_dating_data, by = c("partner_id" = "participant_id")) %>%
# differentiating their age 
  select(participant_id, age.x, partner_id, age.y) %>%
  rename(liker_id = participant_id, liker_age = age.x, liked_id = partner_id, liked_age = age.y)

to View result:
head(liked_data)

```{r filtering the data 2.0}


library(dplyr)

liked_data <- speed_dating_data %>%
   filter(attraction_feeling == 1) %>%  
  select(participant_id, age, gender, partner_id) %>%
  left_join(speed_dating_data, by = c("partner_id" = "participant_id")) %>%
  select(participant_id, age.x, gender.x, partner_id, age.y, gender.y) %>%
  rename(liker_id = participant_id, liker_age = age.x, liker_gender = gender.x, liked_id = partner_id, liked_age = age.y, liked_gender = gender.y)


```
#Creating the good plot
install.packages("ggplot2")
install.packages("dplyr")





```{r heat model}

# Check structure of data
str(liked_data)

# Convert gender to a factor (if not already)
liked_data$liker_gender <- as.factor(liked_data$liker_gender)

# Subset data by gender
male_data <- subset(liked_data, liker_gender == "Male")
female_data <- subset(liked_data, liker_gender == "Female")

library(MASS)  # For kde2d

# Male model
male_density <- kde2d(male_data$liker_age, male_data$liked_age, n = 100)

# Female model
female_density <- kde2d(female_data$liker_age, female_data$liked_age, n = 100)


library(ggplot2)
library(dplyr)

# Bin data into a grid for better distinction
bin_size <- 2  # Adjust for more or less granularity

liked_data_binned <- liked_data %>%
  mutate(
    liker_age_bin = cut(liker_age, breaks = seq(min(liker_age), max(liker_age), by = bin_size), include.lowest = TRUE),
    liked_age_bin = cut(liked_age, breaks = seq(min(liked_age), max(liked_age), by = bin_size), include.lowest = TRUE)
  ) %>%
  group_by(liker_gender, liker_age_bin, liked_age_bin) %>%
  summarise(density = n(), .groups = "drop")

# Convert factors to numeric midpoints for plotting
liked_data_binned$liker_age_bin <- as.numeric(gsub("\\((.*),(.*)]", "\\1", liked_data_binned$liker_age_bin)) + bin_size / 2
liked_data_binned$liked_age_bin <- as.numeric(gsub("\\((.*),(.*)]", "\\1", liked_data_binned$liked_age_bin)) + bin_size / 2

# Plot heatmap with facet_grid() for side-by-side comparison
ggplot(liked_data_binned, aes(x = liker_age_bin, y = liked_age_bin, fill = density)) +
  geom_tile(color = "white") +  # White grid for better separation
  scale_fill_gradient(low = "blue", high = "red") +
  facet_grid(. ~ liker_gender) +  # Side-by-side layout
  labs(title = "Heatmap of Liker Age vs. Liked Age", x = "Liker Age", y = "Liked Age", fill = "Count") +
  theme_minimal()

# Heat map with both genders, is really not nice to see


# Conert density data to a format usable by ggplot2
male_df <- data.frame(expand.grid(x = male_density$x, y = male_density$y), density = as.vector(male_density$z))
female_df <- data.frame(expand.grid(x = female_density$x, y = female_density$y), density = as.vector(female_density$z))

# Plot Male Heatmap
ggplot(male_df, aes(x, y, fill = density)) +
  geom_tile() +
  scale_fill_gradient(low = "blue", high = "red") +
  labs(title = "Heatmap for Males", x = "Liker Age", y = "Liked Age")

# Plot Female Heatmap
ggplot(female_df, aes(x, y, fill = density)) +
  geom_tile() +
  scale_fill_gradient(low = "blue", high = "red") +
  labs(title = "Heatmap for Females", x = "Liker Age", y = "Liked Age")
# heat map with genders separated, visually very appealing but it is not a good PlantGrowth

```
```{r new heat map}
# Set a CRAN mirror (e.g., RStudio's CRAN mirror)
options(repos = c(CRAN = "https://cloud.r-project.org/"))

# Install viridis package if not already installed
install.packages("viridis")

# Load necessary libraries
library(ggplot2)
library(viridis)

ggplot(liked_data, aes(x = liker_age, y = liked_age)) +
  stat_bin2d(bins = 30) +  # Create a 2D histogram (heatmap)
  scale_fill_viridis(option = "D", direction = 1,  # Use "D" variant of viridis (you can try "A", "B", or "C" for other options)
                     limits = c(0, 6)) +  # Set color limits to 0-6
  facet_wrap(~ liker_gender) +  # Separate by gender
  labs(
    title = "Heatmap of Liker Age vs. Liked Age", 
    x = "Liker Age", 
    y = "Liked Age", 
    fill = "Count"
  ) +
  theme_minimal()

```
```{r ridgeline plot}
install.packages("ggridges")

library(ggridges)

ggplot(liked_data, aes(x = liked_age, y = as.factor(liker_age), fill = liker_gender)) +
  geom_density_ridges(alpha = 0.7) +
  facet_wrap(~ liker_gender) +  
  labs(title = "Distribution of Liked Age by Liker Age",
       x = "Liked Age",
       y = "Liker Age") +
  theme_minimal()


```
```{r ridgeline plot second attempt}
library(ggridges)
library(ggplot2)

# Round liker_age to 1 decimal place for finer age divisions
liked_data$liker_age_decimal <- round(liked_data$liker_age, 1)

# Filter liked_data to only include liked ages 18 or above
filtered_data <- liked_data[liked_data$liked_age >= 18, ]

# Create the ridgeline plot with decimal liker's age and filtered liked_age starting at 18
ggplot(filtered_data, aes(x = liked_age, y = as.factor(liker_age_decimal), fill = liker_gender)) +
  geom_density_ridges(alpha = 0.7) +  # Ridgeline plot
  facet_wrap(~ liker_gender) +  # Separate plots for male & female
  labs(
    title = "Distribution of Liked Age by Liker Age",
    x = "Liked Age",
    y = "Liker Age (Decimal)",
    fill = "Gender"
  ) +
  theme_minimal() +
  scale_x_continuous(limits = c(18, NA)) +  # Set x-axis to start from 18
  scale_y_discrete(breaks = c(18, 23, 28, 32, 37, 42))  # Set specific y-axis breaks



```

```{r scatterplot}
ggplot(liked_data, aes(x = liker_age, y = liked_age, color = liker_gender)) +
  geom_jitter(alpha = 0.3) +  # Scatterplot with slight jitter for visibility
  geom_smooth(method = "lm", se = FALSE) +  # Trend line
  labs(title = "Scatterplot of Age Preferences",
       x = "Liker Age",
       y = "Liked Age",
       color = "Gender") +
  theme_minimal()

```

install.packages("ggrain")

library(ggrain)

ggplot(iris, aes(x = liker_gender, y = liked_age, fill = liker_age)) + geom_rain(rain.side = 'l')
# queste cose ti serviranno domani -> 

install.packages("ggdist")  # Needed for geom_rain
install.packages("ggplot2")
install.packages("tidyverse")  # Includes dplyr for %>%


library(ggdist)  # For raincloud plots
library(tidyverse)  # dplyr for data wrangling

```{r good plot}

library(ggplot2)
library(ggdist)  # For raincloud plots
library(tidyverse)  # dplyr for data wrangling

plot <- liked_data %>%
  ggplot(aes(x = liked_age, y = liker_gender, fill = liker_age)) +  
  stat_halfeye(adjust = 0.5, width = 0.5, justification = 0.1, .width = 0, point_colour = "black") +  # "Cloud" part
  geom_dots(side = "left", binwidth = 0.1, color = "blue") +  # "Rain" part
  coord_flip() +  # Flip for better visualization
  theme_minimal() +  # Cleaner style
  labs(title = "Raincloud Plot: Attraction by Age & Gender",
       x = "Liked Age",
       y = "Liker Gender") 

print(plot)

library(dplyr)

liked_data$liker_age_group <- cut(liked_data$liker_age, breaks = c(18, 25, 30, 35, 40), labels = c("18-25", "26-30", "31-35", "36-40"))

# Calculate means for each group
means <- liked_data %>%
  group_by(liker_gender) %>%
  summarize(mean_age = mean(liked_age))


ggplot(liked_data, aes(x = liked_age, y = liker_gender, fill = liker_age_group)) +
  stat_halfeye(adjust = 0.5, width = 0.6, justification = -0.3, 
               .width = 0, point_colour = "black", alpha = 0.5) +  
  geom_dots(side = "left", binwidth =0.5, color = "black", dotsize = 0.5) +
  coord_flip() +
  theme_minimal() +
  scale_y_discrete(expand = expansion(mult = 0.1)) +
  labs(title = "Gender Differences on Attractive Age",
       x = "Liked Age",
       y = "Liker Gender")

```
# # Creating the bad plot 
library(ggplot2)
library(dplyr)
library(gridExtra)  # Required for arranging plots side by side

# Plot for females (likers who are female)
female_plot <- liked_data %>%
  filter(liker_gender == "Female") %>%
  ggplot(aes(x = liker_age, y = liked_age, color = liked_gender)) +  # Relating liker's age and liked's age
  geom_point(alpha = 0.7) +  # Scatter plot
  geom_smooth(method = "lm", se = FALSE, color = "black") +  # Add a regression line
  labs(title = "Attraction to Males by Female Likers", 
       x = "Age of Female Likers", 
       y = "Age of Attracted Males") +
  theme_minimal() +  # Minimal theme for a clean look
  theme(legend.position = "none")

# Plot for males (likers who are male)
male_plot <- liked_data %>%
  filter(liker_gender == "Male") %>%
  ggplot(aes(x = liker_age, y = liked_age, color = liked_gender)) +  # Relating liker's age and liked's age
  geom_point(alpha = 0.7) +  # Scatter plot
  geom_smooth(method = "lm", se = FALSE, color = "black") +  # Add a regression line
  labs(title = "Attraction to Females by Male Likers", 
       x = "Age of Male Likers", 
       y = "Age of Attracted Females") +
  theme_minimal() +  # Minimal theme for a clean look
  theme(legend.position = "none")

# Arrange the plots side by side
grid.arrange(female_plot, male_plot, ncol = 2)



library(ggplot2)


# Example of creating raincloud plot
ggplot(liked_data, aes(x = liker_age, y = liked_age, fill = liker_gender )) +
  # Violin plot for distribution
  geom_violin(scale = "area", alpha = 0.5, trim = TRUE) +
  # Boxplot for central tendency
  geom_boxplot(width = 0.2, fill = "white", color = "black", outlier.shape = NA) +
  # Dot plot for individual data points
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1, fill = "black") +
  # Customization
  theme_minimal() +
  labs(
    title = "Age Distribution of Liker and Liked",
    x = "Liker ID",
    y = "Age"
  ) +
  theme(
    plot.title = element_text(size = 16),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12)
  )


```

