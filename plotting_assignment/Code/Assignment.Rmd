---
title: "Assignment"
output: html_document
date: "2025-02-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Creating the data
Firstly, I am asking R to simulate a speed dating dataset. I am defining the folder path & then creating the folder, while checking before if it doesn't already exist.

data_folder <- "plotting_assignment/data"
if (!dir.exists(data_folder)) {dir.create(data_folder, recursive = TRUE)}

For reproducibility:
set.seed(123)  

Number of participants:
n <- 1000  

speed_dating_data <- data.frame(   

With id from 1 to n (1000):
participant_id = 1:n,    

With age between 18 and 40, the same age can be chosen more than once:
age = sample(18:40, n, replace = TRUE),    

I am considering only cis people:
gender = sample(c("Male", "Female"), n, replace = TRUE),

Random scores from 1 to 10, simulating attractiveness:
attractiveness_rating = runif(n, 1, 10),  

0 = No match, 1 = Match of interests, 60% chances of no match, 40% of match:
interests_match = sample(0:1, n, replace = TRUE, prob = c(0.6, 0.4)), 

Randomly assign a partner_id (random partner for each participant):

partner_id = sample(1:n, n, replace = TRUE))

Save the data as a CSV file inside the "data" folder:

write.csv(speed_dating_data, file = file.path(data_folder, "speed_dating_data.csv"), row.names = FALSE)

Message to confirm:

cat("Speed dating dataset created and saved in 'plotting_assignment/data/speed_dating_data.csv'\n")

```{r Creating the data}
data_folder <- "plotting_assignment/data"

if (!dir.exists(data_folder)) {dir.create(data_folder, recursive = TRUE)}

set.seed(123) 

n <- 1000  

speed_dating_data <- data.frame(   
participant_id = 1:n,    
age = sample(18:40, n, replace = TRUE),    
gender = sample(c("Male", "Female"), n, replace = TRUE),
attractiveness_rating = runif(n, 1, 10),
attraction_feeling = sample(0:1,n, replace = TRUE, prob = c(0.5,0.5)),
interests_match = sample(0:1, n, replace = TRUE, prob = c(0.6, 0.4)),
partner_id = sample(1:n, n, replace = TRUE))

write.csv(speed_dating_data, file = file.path(data_folder, "speed_dating_data.csv"), row.names = FALSE)

cat("Speed dating dataset created and saved in 'plotting_assignment/data/speed_dating_data.csv'\n")


```

# Filtering the data

installing dplyr:
library(dplyr)

Renaming:
liked_data <- speed_dating_data %>%

Keeping only the ones who felt an attraction:
  filter(attraction_feeling == 1) %>%  
  
Keeping only the subject's participant id, age & the partner's id:
  select(participant_id, age, partner_id) %>% 
  
Joining by attracted id:
  left_join(speed_dating_data, by = c("partner_id" = "participant_id")) %>%
  
Selecting age & gender of participant & partner:
select(participant_id, age.x, gender.x, partner_id, age.y, gender.y) %>%

Renaming to distinguish more easily:
rename(subject = participant_id, subject_age = age.x, subject_gender = gender.x, partner = partner_id, partner_age = age.y, partner_gender = gender.y)

To view the results:
head(liked_data)

```{r filtering the data}
library(dplyr)

liked_data <- speed_dating_data %>%
filter(attraction_feeling == 1) %>%  
select(participant_id, age, gender, partner_id) %>%
left_join(speed_dating_data, by = c("partner_id" = "participant_id")) %>%
select(participant_id, age.x, gender.x, partner_id, age.y, gender.y) %>%
rename(subject = participant_id, subject_age = age.x, subject_gender = gender.x, partner = partner_id, partner_age = age.y, partner_gender = gender.y)

```
#Creating the good plot

For visualisation:
library(ggplot2)
To create ridge density plots:
library(ggridges)

Converting gender into a factor, to make it categorical:
liked_data$subject_gender <- as.factor(liked_data$subject_gender)

Subgroupig into 3:
liked_data$subject_age_group <- with(liked_data, paste0(floor((subject_age - 18) / 3) * 3 + 18, "-", floor((subject_age - 18) / 3) * 3 + 20))

mean_data <- liked_data %>%
  group_by(subject_age_group, subject_gender) %>%
  
Calculating the mean partner_age for each group:
  summarise(mean_partner_age = mean(partner_age, na.rm = TRUE)) %>%
  
  ungrouping for eventual further processing:
  ungroup()

Creating the plot:
ggplot(liked_data, aes(x = partner_age, y = subject_age_group, fill = subject_gender)) +

To control transparency:
  geom_density_ridges(alpha = 0.7) +
  
Adding a "mean point":
  geom_point(data = mean_data, aes(x = mean_partner_age, y = subject_age_group),
             shape = 21, size = 3, fill = "black", color = "white") +
             
 Creating two separate plots for two genders:         
  facet_wrap(~ subject_gender) +
  labs(title = "Age Preferences in Dating: Differences across Age groups and Gender",
    x = "Liked Age",
    y = "Subjects",
    Fill = "Gender") +
  theme_minimal()

```{r Good plot}
liked_data$subject_gender <- as.factor(liked_data$subject_gender)

library(dplyr)
library(ggplot2)
library(ggridges)

liked_data$subject_age_group <- with(liked_data, paste0(floor((subject_age - 18) / 3) * 3 + 18, "-", floor((subject_age - 18) / 3) * 3 + 20))


mean_data <- liked_data %>%
  group_by(subject_age_group, subject_gender) %>%
  summarise(mean_partner_age = mean(partner_age, na.rm = TRUE)) %>%
  ungroup()


ggplot(liked_data, aes(x = partner_age, y = subject_age_group, fill = subject_gender)) +
  geom_density_ridges(alpha = 0.7) +
  geom_point(data = mean_data, aes(x = mean_partner_age, y = subject_age_group),
             shape = 21, size = 3, fill = "black", color = "white") +
  facet_wrap(~ subject_gender) +
  labs( title = "Age Preferences in Dating: Differences across Age groups and Gender",
    x = "Liked Age",
    y = "Subjects",
    Fill = "Gender") +
  theme_minimal()
```

```{r Bad plot}

library(ggplot2)
library(ggdist)  # For raincloud plots
library(tidyverse)  # dplyr for data wrangling

plot <- liked_data %>%
  ggplot(aes(x = liked_age, y = subject_gender, fill = subject_age)) +  
  stat_halfeye(adjust = 0.5, width = 0.5, justification = 0.1, .width = 0, point_colour = "black") +  # "Cloud" part
  geom_dots(side = "left", binwidth = 0.1, color = "blue") +  # "Rain" part
  coord_flip() +  # Flip for better visualization
  theme_minimal() +  # Cleaner style
  labs(title = "Raincloud Plot: Attraction by Age & Gender",
       x = "Liked Age",
       y = "subject Gender") 

library(dplyr)

liked_data$subject_age_group <- cut(liked_data$subject_age, breaks = c(18, 25, 30, 35, 40), labels = c("18-25", "26-30", "31-35", "36-40"))

# Calculate means for each group
means <- liked_data %>%
  group_by(subject_gender) %>%
  summarize(mean_age = mean(partner_age))


ggplot(liked_data, aes(x = partner_age, y = subject_gender, fill = subject_age_group)) +
  stat_halfeye(adjust = 0.5, width = 0.6, justification = -0.3, 
               .width = 0, point_colour = "black", alpha = 0.5) +  
  geom_dots(side = "left", binwidth =0.5, color = "black", dotsize = 0.5) +
  coord_flip() +
  theme_minimal() +
  scale_y_discrete(expand = expansion(mult = 0.1)) +
  labs(title = "Gender Differences on Attractive Age",
       x = "Liked Age",
       y = "subject Gender")

```
```{r Bad plot 2.0}

# Example of creating raincloud plot
ggplot(liked_data, aes(x = subject_age, y = partner_age, fill = subject_gender )) +
  # Violin plot for distribution
  geom_violin(scale = "area", alpha = 0.5, trim = TRUE) +
  # Boxplot for central tendency
  geom_boxplot(width = 0.2, fill = "white", color = "black", outlier.shape = NA) +
  # Dot plot for individual data points
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1, fill = "black") +
  # Customization
  theme_minimal() +
  labs(
    title = "Age Distribution of subject and partner",
    x = "subject ID",
    y = "Age"
  ) +
  theme(
    plot.title = element_text(size = 16),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12)
  )


```

